<!DOCTYPE html>
<html lang="en">

<head>
    <title>餵食浦洋</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        body {
            cursor: crosshair;
            /* 預設游標樣式為crosshair */
        }

        .clicked {
            cursor: url('./food.png') 35 35, auto;
            /* 點擊後的游標樣式 */
        }

        #range {
            position: absolute;
            width: 100%;
            height: 100%;
            left: 0px;
            top: 0px;
            background: url(./background.png);
            /* cursor: crosshair;   預設游標樣式為crosshair */
            overflow: hidden;
        }

        #movingImage {
            position: absolute;
            width: 15%;
            height: auto;
            top: 50%;
            /* 圖片在垂直方向上的初始位置 */
            left: 0;
            /* 圖片在水平方向上的初始位置 */
            transition: left 0.3s linear, top 0.3s linear;
            /* 使用過渡效果: 平滑移動 */
        }

        #score {
            font: 16px normal arial, verdana, sans-serif;
            color: red;
            padding: 10px;
        }

        #countdown {
            font: 16px normal arial, verdana, sans-serif;
            color: red;
            padding: 10px;
        }
    </style>
</head>

<body>
    <div id="range" class="clickable-image ">
        <div id="score"> </div>
        <p id="timer"> <span id="countdown">倒數計時: 10 秒</span> </p>
        <button onclick="restartGame()">重新開始遊戲</button>
        <img id="movingImage" src="./player_small.png" alt="Vito">

    </div>
</body>

<script>
    var score = 0;    // 分數
    var shots = 0;   // 總共射擊次數
    var el = null;
    let currentIndex = 0;
    const image = document.getElementById('movingImage');
    // const pathPoints = [
    //     { x: 420, y: 180 }, { x: 260, y: 180 },
    //     { x: 260, y: 480 }, { x: 260, y: 315 },
    //     { x: 420, y: 315 }, { x: 600, y: 180 },
    //     { x: 440, y: 180 }, { x: 440, y: 315 },
    //     { x: 600, y: 315 }, { x: 440, y: 315 },
    //     { x: 440, y: 480 }, { x: 600, y: 480 },
    //     { x: 690, y: 315 }, { x: 690, y: 480 },
    //     { x: 690, y: 315 }, { x: 770, y: 315 },
    //     { x: 770, y: 480 }, { x: 800, y: 315 },
    //     { x: 800, y: 480 }, { x: 800, y: 247 },
    //     { x: 810, y: 247 }, { x: 980, y: 180 },
    //     { x: 820, y: 480 }, { x: 820, y: 180 },
    //     { x: 980, y: 480 }];

    var maxWidth = document.getElementById('range').clientWidth - 40;
    var maxHeight = document.getElementById('range').clientHeight - 100;
    console.log("Max Width: " + maxWidth + "\nMax Height: " + maxHeight);

    var centerWidth = maxWidth / 2;
    var centerHeight = maxHeight / 2;
    var spacingWidth = maxWidth / 37;
    var spacingHeight = maxHeight / 4;

    const pathPoints = [
        //F
        { x: centerWidth - (spacingWidth * 11), y: centerHeight - spacingHeight }, { x: centerWidth - (spacingWidth * 19), y: centerHeight - spacingHeight },
        { x: centerWidth - (spacingWidth * 19), y: centerHeight + 2 * spacingHeight }, { x: centerWidth - (spacingWidth * 19), y: centerHeight },
        { x: centerWidth - (spacingWidth * 11), y: centerHeight },
        //E 
        { x: centerWidth - (spacingWidth / 2), y: centerHeight - spacingHeight }, { x: centerWidth - (spacingWidth * 10), y: centerHeight - spacingHeight },
        { x: centerWidth - (spacingWidth * 10), y: centerHeight }, { x: centerWidth - (spacingWidth / 2), y: centerHeight },
        { x: centerWidth - (spacingWidth * 10), y: centerHeight }, { x: centerWidth - (spacingWidth * 12), y: centerHeight + spacingHeight },
        { x: centerWidth - (spacingWidth / 2), y: centerHeight + spacingHeight },
        //n
        { x: centerWidth, y: centerHeight }, { x: centerWidth, y: centerHeight + spacingHeight },
        { x: centerWidth, y: centerHeight }, { x: centerWidth + (spacingWidth * 4), y: centerHeight },
        { x: centerWidth + (spacingWidth * 4), y: centerHeight + spacingHeight },
        //i
        { x: centerWidth + (spacingWidth * 5), y: centerHeight }, { x: centerWidth + (spacingWidth * 5), y: centerHeight + spacingHeight },
        { x: centerWidth + (spacingWidth * 5), y: centerHeight - (spacingHeight / 2) },
        //X
        { x: centerWidth + (spacingWidth * 14), y: centerHeight - spacingHeight }, { x: centerWidth + (spacingWidth * 6), y: centerHeight + 2 * spacingHeight },
        { x: centerWidth + (spacingWidth * 6), y: centerHeight - spacingHeight }, { x: centerWidth + (spacingWidth * 14), y: centerHeight + 2 * spacingHeight }
    ]
    function moveImage() {
        if (currentIndex >= pathPoints.length) {
            currentIndex = 0;
        }
        const targetX = pathPoints[currentIndex].x;
        const targetY = pathPoints[currentIndex].y;

        image.style.left = targetX + 'px';
        image.style.top = targetY + 'px';

        currentIndex++;
        setTimeout(moveImage, 200); // 控制移動速度，每0.2秒移動一次
    }
    function scoreUp() {	//增加分数並變換游標圖
        score++;

         function changeCursor() {
            event.preventDefault(); // 阻止預設行為
            document.body.classList.add('clicked'); // 整個視窗的游標改變
            setTimeout(() => {
                document.body.classList.remove('clicked'); // 200 毫秒後恢復原樣
            }, 200);
        }

        // 添加點擊事件監聽
        el.addEventListener('click', changeCursor);

        // 添加觸摸事件監聽以支援手機瀏覽器
        el.addEventListener('touchstart', changeCursor);
        el.addEventListener('touchend', changeCursor);
    }
    function scoreboard() {  //更新分數板
        document.getElementById("score").innerHTML = "總點擊次數: " + shots + " 分數: " + score;
    }

    document.addEventListener('DOMContentLoaded', function () {
        document.addEventListener('contextmenu', function (e) {
            e.preventDefault();
        }, false);
    }); //禁止按右鍵

    window.onload = function () {

        el = document.getElementById("movingImage");
        el.onclick = scoreUp;   // 點擊圖片時增加分數
        document.getElementById("range").onclick = function () {  //更新總點擊次數
            shots++;
            scoreboard();
        }

        scoreboard();     //初始化遊戲            
        moveImage(); // 啟動移動函數
        startCountdown();   // 初始開始倒數計時 
    }

    var countdownElement = document.getElementById('countdown');
    var countdownInterval;
    var countdown = 10; //初始倒數計時時間，單位: 秒
    function startCountdown() {
        countdownInterval = setInterval(function () {
            countdown--;
            countdownElement.textContent = "倒數計時: " + countdown;

            if (countdown <= 0) {
                clearInterval(countdownInterval);
                endGame();
            }
        }, 1000); // 每秒執行一次
    }
    function endGame() {
        var rate = 0;
        if (shots == 0)
            rate = 0;
        else
            rate = ((score / shots) * 100).toFixed(2);

        if (rate >= 40)
            alert("時間到！\n太棒啦~此次餵食成功率高達" + rate + "%！\n有發現嗎~浦洋的飛行路線是FEniX的字樣喔！");
        else
            alert("時間到！\n可惜...此次餵食成功率只有" + rate + "%！\n小技巧分享，可以試試看用手機橫向的狀態或是用電腦玩");


        el.onclick = null;
        document.getElementById("range").onclick = null;
    }
    function restartGame() {
        countdown = 10;
        score = 0;
        shots = 0;
        countdownElement.textContent = "倒數計時: " + countdown;
        clearInterval(countdownInterval);

        el.onclick = scoreUp;   // 點擊圖片時增加分數
        document.getElementById("range").onclick = function () {  //更新總點擊次數
            shots++;
            scoreboard();
        }

        location.reload();//初始化遊戲 
        scoreboard();
        startCountdown();   // 初始開始倒數計時
    }

</script>

</html>
